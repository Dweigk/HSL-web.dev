name: CI-Pipeline

on:
  push:
    branches: [ main ]

jobs:
  build-test-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v3

      - name: ğŸ”§ Build ausfÃ¼hren
        run: bash ./build.sh

      - name: âœ… Tests ausfÃ¼hren
        run: bash ./test.sh

      - name: ğŸš¨ Linting (optional)
        if: exists('./lint.sh')
        run: bash ./lint.sh

      - name: ğŸ” SSH-Agent starten
        env:
          DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
        run: |
          echo "$DEPLOY_KEY" > key.pem
          chmod 600 key.pem
          eval "$(ssh-agent -s)"
          ssh-add key.pem

      - name: ğŸš€ Deployment ausfÃ¼hren
        if: success() && github.ref == 'refs/heads/main'
        run: bash ./deploy.sh
